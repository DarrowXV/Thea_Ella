<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Fun v2</title>
    <style>
        :root {
            --primary: #4A90E2;
            --accent: #FF6B6B;
            --bg: #F0F4F8;
            --card: #ffffff;
            --text: #333333;
            --success: #2ECC71;
        }

        body {
            font-family: 'Comic Sans MS', 'Comic Neue', sans-serif; /* Friendlier font for kids */
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            touch-action: manipulation; 
        }

        .container {
            background: var(--card);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 600px;
            margin-top: 20px;
            position: relative;
            z-index: 10;
        }

        h1 { margin: 0 0 15px 0; color: var(--primary); }

        /* Buttons */
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            font-size: 1.2rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.96); }
        .btn-thea { background-color: #9B59B6; }
        .btn-ella { background-color: #2ECC71; }
        .btn-submit { background-color: var(--primary); font-size: 1.5rem; }
        .btn-clear { background-color: #95a5a6; width: auto; display: inline-block; padding: 5px 15px; font-size: 0.9rem; margin-top: 5px;}
        
        .toggle-draw {
            background: #f1c40f;
            color: #333;
            margin-bottom: 5px;
        }

        /* Game Elements */
        .header-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.1rem;
            color: #7f8c8d;
        }

        .streak-box { color: #e67e22; font-weight: bold; }

        .question-box {
            font-size: 3rem;
            margin: 10px 0;
            font-weight: bold;
        }

        input[type="number"] {
            width: 140px;
            height: 60px;
            font-size: 2.5rem;
            text-align: center;
            border: 3px solid #ddd;
            border-radius: 12px;
            margin-bottom: 15px;
            outline: none;
        }
        input[type="number"]:focus { border-color: var(--primary); }

        /* Scratchpad Canvas */
        #scratch-container {
            display: none; /* Hidden by default */
            margin-top: 15px;
            border: 2px dashed #bdc3c7;
            border-radius: 10px;
            background: #fff;
            position: relative;
        }
        
        canvas {
            touch-action: none; /* Prevents scrolling while drawing */
            width: 100%;
            height: 250px;
            border-radius: 10px;
            cursor: crosshair;
        }

        .helper-text { font-size: 0.8rem; color: #999; margin-top: -5px; margin-bottom: 10px;}

        /* Utilities */
        .hidden { display: none !important; }
        .feedback { height: 25px; font-weight: bold; font-size: 1.2rem; margin-top: 10px; }
        .correct { color: var(--success); }
        .wrong { color: var(--accent); }

    </style>
</head>
<body>

    <div class="container" id="main-card">
        <div id="profile-select">
            <h1>Math Time! üéì</h1>
            <p>Select your profile:</p>
            <button class="btn btn-thea" onclick="startGame('Thea')">Thea (Age 10)</button>
            <button class="btn btn-ella" onclick="startGame('Ella')">Ella (Age 7)</button>
        </div>

        <div id="game-area" class="hidden">
            <div class="header-bar">
                <span onclick="goHome()" style="cursor:pointer">‚¨Ö Menu</span>
                <span class="streak-box">üî• Streak: <span id="streak">0</span></span>
            </div>
            
            <div class="question-box" id="question">2 + 2</div>

            <input type="number" id="answer-input" placeholder="?" pattern="\d*">
            
            <button class="btn btn-submit" onclick="checkAnswer()">Check Answer</button>
            <div class="feedback" id="feedback"></div>

            <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">

            <button class="btn toggle-draw" onclick="toggleScratchpad()">‚úèÔ∏è Show Working Out</button>
            
            <div id="scratch-container">
                <canvas id="drawing-board"></canvas>
                <div style="text-align: right; padding: 5px;">
                    <button class="btn btn-clear" onclick="clearCanvas()">Clear Pad</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // GAME LOGIC
        let currentProfile = '';
        let currentAnswer = 0;
        let streak = 0;

        const profileScreen = document.getElementById('profile-select');
        const gameScreen = document.getElementById('game-area');
        const streakEl = document.getElementById('streak');
        const questionEl = document.getElementById('question');
        const inputEl = document.getElementById('answer-input');
        const feedbackEl = document.getElementById('feedback');
        const scratchContainer = document.getElementById('scratch-container');

        // CANVAS LOGIC
        const canvas = document.getElementById('drawing-board');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;

        // Resize canvas to fit container
        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#333';
        }

        window.addEventListener('resize', resizeCanvas);

        function startGame(name) {
            currentProfile = name;
            streak = 0;
            streakEl.innerText = '0';
            
            profileScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            
            // Wait for display change to render canvas size correctly
            setTimeout(resizeCanvas, 50);
            generateQuestion();
        }

        function goHome() {
            gameScreen.classList.add('hidden');
            profileScreen.classList.remove('hidden');
            inputEl.value = '';
            feedbackEl.innerText = '';
            clearCanvas();
            scratchContainer.style.display = 'none'; // Auto hide scratchpad on exit
        }

        function toggleScratchpad() {
            if (scratchContainer.style.display === 'block') {
                scratchContainer.style.display = 'none';
            } else {
                scratchContainer.style.display = 'block';
                resizeCanvas(); // Ensure size is correct when opened
            }
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Drawing Event Listeners (Touch & Mouse)
        function startDraw(e) {
            isDrawing = true;
            draw(e);
        }
        function endDraw() {
            isDrawing = false;
            ctx.beginPath();
        }
        function draw(e) {
            if (!isDrawing) return;

            // Get position relative to canvas
            const rect = canvas.getBoundingClientRect();
            let x, y;

            if (e.touches) {
                x = e.touches[0].clientX - rect.left;
                y = e.touches[0].clientY - rect.top;
            } else {
                x = e.clientX - rect.left;
                y = e.clientY - rect.top;
            }

            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mouseup', endDraw);
        canvas.addEventListener('mousemove', draw);

        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDraw(e); }, {passive: false});
        canvas.addEventListener('touchend', (e) => { e.preventDefault(); endDraw(); }, {passive: false});
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); }, {passive: false});


        // MATH LOGIC
        function generateQuestion() {
            inputEl.value = '';
            inputEl.focus();
            feedbackEl.innerText = '';
            
            let num1, num2, operator;

            if (currentProfile === 'Ella') {
                // Ella (Age 7): Simple Add/Sub
                if (Math.random() > 0.4) {
                    operator = '+';
                    num1 = Math.floor(Math.random() * 15); 
                    num2 = Math.floor(Math.random() * 10); 
                    currentAnswer = num1 + num2;
                } else {
                    operator = '-';
                    num1 = Math.floor(Math.random() * 15) + 5; 
                    num2 = Math.floor(Math.random() * (num1 - 2)) + 1;
                    currentAnswer = num1 - num2;
                }
            } else {
                // Thea (Age 10): Complex mix
                const type = Math.random();
                if (type < 0.25) { 
                    operator = '+';
                    num1 = Math.floor(Math.random() * 80) + 10; 
                    num2 = Math.floor(Math.random() * 80) + 10;
                    currentAnswer = num1 + num2;
                } else if (type < 0.5) {
                    operator = '-';
                    num1 = Math.floor(Math.random() * 100) + 20;
                    num2 = Math.floor(Math.random() * (num1 - 10)) + 5;
                    currentAnswer = num1 - num2;
                } else if (type < 0.8) {
                    operator = '√ó';
                    num1 = Math.floor(Math.random() * 12) + 2; 
                    num2 = Math.floor(Math.random() * 12) + 2;
                    currentAnswer = num1 * num2;
                } else {
                    operator = '√∑';
                    num2 = Math.floor(Math.random() * 10) + 2; 
                    currentAnswer = Math.floor(Math.random() * 11) + 1; 
                    num1 = currentAnswer * num2; 
                }
            }
            questionEl.innerText = `${num1} ${operator} ${num2}`;
        }

        function checkAnswer() {
            const userVal = parseInt(inputEl.value);
            if (isNaN(userVal)) return;

            if (userVal === currentAnswer) {
                streak++;
                streakEl.innerText = streak;
                feedbackEl.innerText = "Correct! üéâ";
                feedbackEl.className = "feedback correct";
                clearCanvas(); // Optional: Auto-clear pad on correct answer?
                setTimeout(generateQuestion, 1000);
            } else {
                streak = 0; // Reset streak on error
                streakEl.innerText = streak;
                feedbackEl.innerText = "Try again! ‚ùå";
                feedbackEl.className = "feedback wrong";
                inputEl.value = '';
                inputEl.focus();
            }
        }
        
        // Enter key support
        inputEl.addEventListener("keypress", function(event) {
            if (event.key === "Enter") checkAnswer();
        });

    </script>
</body>
</html>
